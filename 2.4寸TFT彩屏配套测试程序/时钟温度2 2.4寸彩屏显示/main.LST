C51 COMPILER V7.06   MAIN                                                                  10/29/2016 13:03:40 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: K:\win7\keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          /*-----------------------------------------------
   2            ƣʾʵʱʱ¶
   3            ̳www.doflye.net
   4            дshifang
   5            ڣ2009.5
   6            ޸ģ
   7            ݣͨȡds1302ϢֱʾҺϡбõأϵʱԿСͨڵʱ
             -䡣·ʽ
   8                  ڷдʱϢʽ 2009071210102005 ʾ2009712 101020 壬Ȼͨ
             -ڷͣӲӷʽ
   9                          ͨͬעм䲻пո
  10                          ¶ȴ18B20ʾ¶
  11            -----------------------------------------------*/
  12          #include<reg52.h>
  13          #include"ds1302.h"
  14          #include"9325tp.h"
  15          #include "18b20.h"
  16          /*-----------------------------------------------
  17                            ȫֱ
  18          -----------------------------------------------*/
  19          #define TOP    10
  20          #define BOTTOM 10
  21          #define LEFT   15
  22          #define RIGHT  10
  23          #define DISTANCE  20
  24          
  25          #define CCOLOR 0xffff //ǰɫ
  26          
  27          #define BCOLOR 0x0000 //ɫ
  28          
  29          unsigned int temp; //¶ʱ
  30          unsigned char TempH,TempL;
  31          bit SetFlag;       //ʱ־λ
  32          unsigned char   time_buf2[16];
  33          unsigned char timeold;
  34          /*-----------------------------------------------
  35                            
  36          -----------------------------------------------*/
  37          void disp(void);
  38          /*------------------------------------------------
  39                        ͨѶʼ
  40          ------------------------------------------------*/
  41          void UART_Init(void)
  42          {
  43   1          SCON  = 0x50;                       // SCON: ģʽ 1, 8-bit UART, ʹܽ  
  44   1          TMOD |= 0x20;               // TMOD: timer 1, mode 2, 8-bit װ
  45   1          TH1   = 0xFD;               // TH1:  װֵ 9600   11.0592MHz  
  46   1          TR1   = 1;                  // TR1:  timer 1                          
  47   1          EA    = 1;                  //ж
  48   1          ES    = 1;                  //򿪴ж
  49   1      }
  50          
  51          /*------------------------------------------------
  52                                
  53          ------------------------------------------------*/
C51 COMPILER V7.06   MAIN                                                                  10/29/2016 13:03:40 PAGE 2   

  54          main()
  55          {
  56   1        unsigned char i;
  57   1      
  58   1             UART_Init();
  59   1                 
  60   1             Ds1302_Init(); /*DS302ʼ*/
  61   1             ILI9325_Initial(); //ʼLCD
  62   1             CLR_Screen(BCOLOR); //ñɫ
  63   1             //ƾƽ
  64   1                 Show_RGB(LEFT,LEFT+100,TOP,TOP+140,0xff00);
  65   1                 Show_RGB(LEFT+120,LEFT+220,TOP,TOP+140,0x00ff);
  66   1                 Show_RGB(LEFT,LEFT+100,TOP+160,TOP+300,0x0ff0);
  67   1                 Show_RGB(LEFT+120,LEFT+220,TOP+160,TOP+300,0xf00f);
  68   1             //ο
  69   1                 Rectangle(LEFT,TOP,LEFT+100,TOP+140,CCOLOR);
  70   1                 Rectangle(LEFT+1,TOP+1,LEFT+99,TOP+139,CCOLOR);
  71   1      
  72   1                 LCD_PutString(LEFT+10,TOP+10,"ǰڣ",CCOLOR,BCOLOR);
  73   1             LCD_PutString(LEFT+10,DISTANCE*2+TOP+10,"ǰʱ䣺",CCOLOR,BCOLOR);
  74   1                 LCD_PutString(LEFT+10,DISTANCE*4+TOP+10,"",CCOLOR,BCOLOR);
  75   1                 LCD_PutString(LEFT+10,DISTANCE*5+TOP+12,"¶ȣ   ",CCOLOR,BCOLOR);
  76   1             //м
  77   1                 Line(LEFT,TOP+DISTANCE+8,LEFT+100,TOP+DISTANCE+8,CCOLOR);
  78   1             Line(LEFT,TOP+DISTANCE*2+8,LEFT+100,TOP+DISTANCE*2+8,CCOLOR);
  79   1                 Line(LEFT,TOP+DISTANCE*3+8,LEFT+100,TOP+DISTANCE*3+8,CCOLOR);
  80   1                 Line(LEFT,TOP+DISTANCE*4+8,LEFT+100,TOP+DISTANCE*4+8,CCOLOR);
  81   1                 Line(LEFT,TOP+DISTANCE*5+8,LEFT+100,TOP+DISTANCE*5+8,CCOLOR);
  82   1        while(1)
  83   1             {
  84   2                  timeold=time_buf1[6]; // ڼʱǷı
  85   2                  Ds1302_Read_Time();//ȡʱϢ
  86   2      
  87   2                      if(timeold!=time_buf1[6])
  88   2                       {
  89   3               temp=ReadTemperature();//ȡ¶
  90   3                       TempH=temp>>4;
  91   3               TempL=temp&0x0F;
  92   3               TempL=TempL*6/10;//Сƴ
  93   3               disp();         //ҺʾʱϢ
  94   3               }
  95   2                         if(SetFlag)     //յϢʱ
  96   2                           {
  97   3                               for(i=0;i<8;i++)
  98   3                               {
  99   4                               time_buf1[i]=time_buf2[2*i]*10+time_buf2[2*i+1];//ϣ2 15ϳ15
 100   4                               }
 101   3                               Ds1302_Write_Time();
 102   3                               SetFlag=0;     //ʱϢº־λ
 103   3                               }
 104   2                   }
 105   1       
 106   1        }
 107          
 108          /*------------------------------------------------
 109                            жϳ
 110          ------------------------------------------------*/
 111          void UART_SER (void) interrupt 4 //жϷ
 112          {
 113   1          unsigned char Temp;          //ʱ 
 114   1          unsigned char i;
 115   1          if(RI)                        //жǽжϲ
C51 COMPILER V7.06   MAIN                                                                  10/29/2016 13:03:40 PAGE 3   

 116   1           {
 117   2                RI=0;                      //־λ
 118   2                Temp=SBUF;                 //뻺ֵ
 119   2                time_buf2[i]=Temp&0x0F;
 120   2                i++;
 121   2                if(i==16)                  //16ַϢ
 122   2                 {
 123   3                  i=0;
 124   3                      SetFlag=1;               //ɱ־λ1
 125   3                 }
 126   2            SBUF=Temp; //ѽյֵٷصԶ
 127   2               }
 128   1         if(TI)  //Ƿͱ־λ
 129   1           TI=0;
 130   1      } 
 131          
 132          /*------------------------------------------------
 133                       ʾ
 134          ------------------------------------------------*/
 135          void disp(void)
 136          
 137          {
 138   1       
 139   1       unsigned char  TempData[10];
 140   1      
 141   1       TempData[0]='2';
 142   1       TempData[1]='0';
 143   1       TempData[2]='0'+time_buf1[1]/10;
 144   1       TempData[3]='0'+time_buf1[1]%10;
 145   1       TempData[4]='-';
 146   1       TempData[5]='0'+time_buf1[2]/10;
 147   1       TempData[6]='0'+time_buf1[2]%10;
 148   1       TempData[7]='-';
 149   1       TempData[8]='0'+time_buf1[3]/10;
 150   1       TempData[9]='0'+time_buf1[3]%10;
 151   1      
 152   1       LCD_PutString(LEFT+10,DISTANCE+TOP+10,TempData,CCOLOR,BCOLOR);
 153   1      
 154   1      
 155   1       
 156   1       TempData[0]='0'+time_buf1[4]/10;
 157   1       TempData[1]='0'+time_buf1[4]%10;
 158   1       TempData[2]=':';
 159   1       TempData[3]='0'+time_buf1[5]/10;
 160   1       TempData[4]='0'+time_buf1[5]%10;
 161   1       TempData[5]=':';
 162   1       TempData[6]='0'+time_buf1[6]/10;
 163   1       TempData[7]='0'+time_buf1[6]%10;
 164   1       TempData[8]=' ';
 165   1       TempData[9]=' ';
 166   1      
 167   1      LCD_PutString(LEFT+10,DISTANCE*3+TOP+10,TempData,CCOLOR,BCOLOR);
 168   1      
 169   1      switch(time_buf1[7])
 170   1      {
 171   2       case 1:LCD_PutString(LEFT+42,DISTANCE*4+TOP+10,"һ",CCOLOR,BCOLOR);break;
 172   2       case 2:LCD_PutString(LEFT+42,DISTANCE*4+TOP+10,"",CCOLOR,BCOLOR);break;
 173   2       case 3:LCD_PutString(LEFT+42,DISTANCE*4+TOP+10,"",CCOLOR,BCOLOR);break;
 174   2       case 4:LCD_PutString(LEFT+42,DISTANCE*4+TOP+10,"",CCOLOR,BCOLOR);break;
 175   2       case 5:LCD_PutString(LEFT+42,DISTANCE*4+TOP+10,"",CCOLOR,BCOLOR);break;
 176   2       case 6:LCD_PutString(LEFT+42,DISTANCE*4+TOP+10,"",CCOLOR,BCOLOR);break;
 177   2       case 7:LCD_PutString(LEFT+42,DISTANCE*4+TOP+10,"",CCOLOR,BCOLOR);break;
C51 COMPILER V7.06   MAIN                                                                  10/29/2016 13:03:40 PAGE 4   

 178   2       default:break;
 179   2      }
 180   1      
 181   1       TempData[8]='0'+(TempH%100)/10;
 182   1       TempData[9]='0'+(TempH%100)%10; //ֻʹ2λ
 183   1      LCD_PutString(LEFT+58,DISTANCE*5+TOP+12,&TempData[8],CCOLOR,BCOLOR);
 184   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    904    ----
   CONSTANT SIZE    =     60    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
