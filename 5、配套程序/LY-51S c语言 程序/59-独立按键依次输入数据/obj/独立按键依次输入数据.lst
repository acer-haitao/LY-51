C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  06/15/2010 18:31:27 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ
OBJECT MODULE PLACED IN .\obj\¶ÀÁ¢°´¼üÒÀ´ÎÊäÈëÊı¾İ.obj
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE ¶ÀÁ¢°´¼üÒÀ´ÎÊäÈëÊı¾İ.c BROWSE DEBUG OBJECTEXTEND PRINT(.\obj\¶ÀÁ¢°´¼üÒÀ´ÎÊä
                    -ÈëÊı¾İ.lst) OBJECT(.\obj\¶ÀÁ¢°´¼üÒÀ´ÎÊäÈëÊı¾İ.obj)

stmt level    source

   1          /*-----------------------------------------------
   2            Ãû³Æ£ºµ¥¸ö¶ÀÁ¢°´¼üÒÀ´ÎÊäÈë¿ØÖÆ
   3            ÂÛÌ³£ºwww.doflye.net
   4            ±àĞ´£ºshifang
   5            ÈÕÆÚ£º2009.5
   6            ĞŞ¸Ä£ºÎŞ
   7            ÄÚÈİ£ºÈç¼ÆËãÆ÷ÊäÈëÊı¾İĞÎÊ½ÏàÍ¬ ´Ó×óÍùÓÒ
   8          ------------------------------------------------*/
   9          #include<reg52.h> //°üº¬Í·ÎÄ¼ş£¬Ò»°ãÇé¿ö²»ĞèÒª¸Ä¶¯£¬Í·ÎÄ¼ş°üº¬ÌØÊâ¹¦ÄÜ¼Ä´æÆ÷µÄ¶¨Òå
  10          
  11          sbit KEY1=P3^0;  //¶¨Òå°´¼üÊäÈë¶Ë¿Ú
  12          sbit KEY2=P3^1;
  13          sbit KEY3=P3^2;
  14          sbit KEY4=P3^3;
  15          sbit KEY5=P3^4;
  16          sbit KEY6=P3^5;
  17          sbit KEY7=P3^6;
  18          sbit KEY8=P3^7;
  19          
  20          
  21          #define DataPort P0 //¶¨ÒåÊı¾İ¶Ë¿Ú ³ÌĞòÖĞÓöµ½DataPort ÔòÓÃP0 Ìæ»»
  22          sbit LATCH1=P2^2;//¶¨ÒåËø´æÊ¹ÄÜ¶Ë¿Ú ¶ÎËø´æ
  23          sbit LATCH2=P2^3;//                 Î»Ëø´æ
  24          
  25          unsigned char code dofly_DuanMa[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};// ÏÔÊ¾¶ÎÂëÖµ0~9
  26          unsigned char code dofly_WeiMa[]={0xfe,0xfd,0xfb,0xf7,0xef,0xdf,0xbf,0x7f};//·Ö±ğ¶ÔÓ¦ÏàÓ¦µÄÊıÂë¹ÜµãÁÁ,¼´Î»
             -Âë
  27          unsigned char TempData[8]; //´æ´¢ÏÔÊ¾ÖµµÄÈ«¾Ö±äÁ¿
  28          
  29          void DelayUs2x(unsigned char t);//us¼¶ÑÓÊ±º¯ÊıÉùÃ÷ 
  30          void DelayMs(unsigned char t); //ms¼¶ÑÓÊ±
  31          void Display(unsigned char FirstBit,unsigned char Num);//ÊıÂë¹ÜÏÔÊ¾º¯Êı
  32          unsigned char KeyScan(void);//¼üÅÌÉ¨Ãè
  33          void Init_Timer0(void);//¶¨Ê±Æ÷³õÊ¼»¯
  34          /*------------------------------------------------
  35                              Ö÷º¯Êı
  36          ------------------------------------------------*/
  37          void main (void)
  38          {
  39   1      unsigned char num,i,j;                  
  40   1      
  41   1      Init_Timer0();
  42   1      
  43   1      while (1)         //Ö÷Ñ­»·
  44   1        {
  45   2      
  46   2      
  47   2       num=KeyScan();
  48   2       if(num)
  49   2         {
  50   3        if(i<8)
  51   3          TempData[i]=dofly_DuanMa[num];
  52   3              i++;
  53   3              if(i==9)//¶à³öÒ»¸ö°´¼üÊäÈëÎªÁËÇåÆÁ Ô­±¾Ó¦¸ÃÎª8
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  06/15/2010 18:31:27 PAGE 2   

  54   3                {
  55   4                i=0;
  56   4            for(j=0;j<8;j++)//ÇåÆÁ
  57   4               TempData[j]=0;
  58   4             }
  59   3         }
  60   2        //Display(0,8); //ÏÔÊ¾È«²¿8Î»
  61   2           //Ö÷Ñ­»·ÖĞÌí¼ÓÆäËûĞèÒªÒ»Ö±¹¤×÷µÄ³ÌĞò
  62   2              
  63   2        }
  64   1      }
  65          /*------------------------------------------------
  66           uSÑÓÊ±º¯Êı£¬º¬ÓĞÊäÈë²ÎÊı unsigned char t£¬ÎŞ·µ»ØÖµ
  67           unsigned char ÊÇ¶¨ÒåÎŞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
  68           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à,´óÖÂÑÓÊ±
  69           ³¤¶ÈÈçÏÂ T=tx2+5 uS 
  70          ------------------------------------------------*/
  71          void DelayUs2x(unsigned char t)
  72          {   
  73   1       while(--t);
  74   1      }
  75          /*------------------------------------------------
  76           mSÑÓÊ±º¯Êı£¬º¬ÓĞÊäÈë²ÎÊı unsigned char t£¬ÎŞ·µ»ØÖµ
  77           unsigned char ÊÇ¶¨ÒåÎŞ·ûºÅ×Ö·û±äÁ¿£¬ÆäÖµµÄ·¶Î§ÊÇ
  78           0~255 ÕâÀïÊ¹ÓÃ¾§Õñ12M£¬¾«È·ÑÓÊ±ÇëÊ¹ÓÃ»ã±à
  79          ------------------------------------------------*/
  80          void DelayMs(unsigned char t)
  81          {
  82   1           
  83   1       while(t--)
  84   1       {
  85   2           //´óÖÂÑÓÊ±1mS
  86   2           DelayUs2x(245);
  87   2               DelayUs2x(245);
  88   2       }
  89   1      }
  90          /*------------------------------------------------
  91           ÏÔÊ¾º¯Êı£¬ÓÃÓÚ¶¯Ì¬É¨ÃèÊıÂë¹Ü
  92           ÊäÈë²ÎÊı FirstBit ±íÊ¾ĞèÒªÏÔÊ¾µÄµÚÒ»Î»£¬Èç¸³Öµ2±íÊ¾´ÓµÚÈı¸öÊıÂë¹Ü¿ªÊ¼ÏÔÊ¾
  93           ÈçÊäÈë0±íÊ¾´ÓµÚÒ»¸öÏÔÊ¾¡£
  94           Num±íÊ¾ĞèÒªÏÔÊ¾µÄÎ»Êı£¬ÈçĞèÒªÏÔÊ¾99Á½Î»ÊıÖµÔò¸ÃÖµÊäÈë2
  95          ------------------------------------------------*/
  96          void Display(unsigned char FirstBit,unsigned char Num)
  97          {
  98   1            static unsigned char i=0;
  99   1                
 100   1      
 101   1                 DataPort=0;   //Çå¿ÕÊı¾İ£¬·ÀÖ¹ÓĞ½»ÌæÖØÓ°
 102   1             LATCH1=1;     //¶ÎËø´æ
 103   1             LATCH1=0;
 104   1      
 105   1             DataPort=dofly_WeiMa[i+FirstBit]; //È¡Î»Âë 
 106   1             LATCH2=1;     //Î»Ëø´æ
 107   1             LATCH2=0;
 108   1      
 109   1             DataPort=TempData[i]; //È¡ÏÔÊ¾Êı¾İ£¬¶ÎÂë
 110   1             LATCH1=1;     //¶ÎËø´æ
 111   1             LATCH1=0;
 112   1             
 113   1                 i++;
 114   1             if(i==Num)
 115   1                    i=0;
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  06/15/2010 18:31:27 PAGE 3   

 116   1      
 117   1      
 118   1      }
 119          /*------------------------------------------------
 120                              ¶¨Ê±Æ÷³õÊ¼»¯×Ó³ÌĞò
 121          ------------------------------------------------*/
 122          void Init_Timer0(void)
 123          {
 124   1       TMOD |= 0x01;    //Ê¹ÓÃÄ£Ê½1£¬16Î»¶¨Ê±Æ÷£¬Ê¹ÓÃ"|"·ûºÅ¿ÉÒÔÔÚÊ¹ÓÃ¶à¸ö¶¨Ê±Æ÷Ê±²»ÊÜÓ°Ïì                 
 125   1       //TH0=0x00;          //¸ø¶¨³õÖµ
 126   1       //TL0=0x00;
 127   1       EA=1;            //×ÜÖĞ¶Ï´ò¿ª
 128   1       ET0=1;           //¶¨Ê±Æ÷ÖĞ¶Ï´ò¿ª
 129   1       TR0=1;           //¶¨Ê±Æ÷¿ª¹Ø´ò¿ª
 130   1      }
 131          /*------------------------------------------------
 132                           ¶¨Ê±Æ÷ÖĞ¶Ï×Ó³ÌĞò
 133          ------------------------------------------------*/
 134          void Timer0_isr(void) interrupt 1 
 135          {
 136   1       TH0=(65536-2000)/256;            //ÖØĞÂ¸³Öµ 2ms
 137   1       TL0=(65536-2000)%256;
 138   1       
 139   1       Display(0,8);       // µ÷ÓÃÊıÂë¹ÜÉ¨Ãè
 140   1      
 141   1      }
 142          
 143          /*------------------------------------------------
 144          °´¼üÉ¨Ãèº¯Êı£¬·µ»ØÉ¨Ãè¼üÖµ
 145          ------------------------------------------------*/
 146          unsigned char KeyScan(void)
 147          {
 148   1      /********************************************************/  
 149   1      if(!KEY1)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 150   1          {
 151   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 152   2           if(!KEY1)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 153   2                 {
 154   3              while(!KEY1);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 155   3                     {
 156   4                         return 1;
 157   4                              }
 158   3                 }
 159   2              }
 160   1      /********************************************************/  
 161   1      else if(!KEY2)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 162   1          {
 163   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 164   2           if(!KEY2)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 165   2                 {
 166   3              while(!KEY2);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 167   3                     {
 168   4                         return 2;
 169   4                              }
 170   3                 }
 171   2              }
 172   1      /********************************************************/  
 173   1      else if(!KEY3)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 174   1          {
 175   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 176   2           if(!KEY3)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 177   2                 {
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  06/15/2010 18:31:27 PAGE 4   

 178   3              while(!KEY3);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 179   3                     {
 180   4                         return 3;
 181   4                              }
 182   3                 }
 183   2              }
 184   1      /********************************************************/  
 185   1      else if(!KEY4)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 186   1          {
 187   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 188   2           if(!KEY4)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 189   2                 {
 190   3              while(!KEY4);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 191   3                     {
 192   4                         return 4;
 193   4                              }
 194   3                 }
 195   2              }
 196   1      /********************************************************/  
 197   1      else if(!KEY5)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 198   1          {
 199   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 200   2           if(!KEY5)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 201   2                 {
 202   3              while(!KEY5);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 203   3                     {
 204   4                         return 5;
 205   4                              }
 206   3                 }
 207   2              }
 208   1      /********************************************************/  
 209   1      else if(!KEY6)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 210   1          {
 211   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 212   2           if(!KEY6)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 213   2                 {
 214   3              while(!KEY6);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 215   3                     {
 216   4                         return 6;
 217   4                              }
 218   3                 }
 219   2              }
 220   1      /********************************************************/  
 221   1      else if(!KEY7)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 222   1          {
 223   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 224   2           if(!KEY7)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 225   2                 {
 226   3              while(!KEY7);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 227   3                     {
 228   4                         return 7;
 229   4                              }
 230   3                 }
 231   2              }
 232   1      /********************************************************/  
 233   1      else if(!KEY8)  //Èç¹û¼ì²âµ½µÍµçÆ½£¬ËµÃ÷°´¼ü°´ÏÂ
 234   1          {
 235   2               DelayMs(10); //ÑÓÊ±È¥¶¶£¬Ò»°ã10-20ms
 236   2           if(!KEY8)     //ÔÙ´ÎÈ·ÈÏ°´¼üÊÇ·ñ°´ÏÂ£¬Ã»ÓĞ°´ÏÂÔòÍË³ö
 237   2                 {
 238   3              while(!KEY8);//Èç¹ûÈ·ÈÏ°´ÏÂ°´¼üµÈ´ı°´¼üÊÍ·Å£¬Ã»ÓĞÔòÍË³ö
 239   3                     {
C51 COMPILER V7.06   _ÀÁ___¼üÒÀ_ÎÊ_ÈëÊı_İ                                                  06/15/2010 18:31:27 PAGE 5   

 240   4                         return 8;
 241   4                              }
 242   3                 }
 243   2              }
 244   1      /********************************************************/  
 245   1      else
 246   1          return 0;
 247   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    323    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
